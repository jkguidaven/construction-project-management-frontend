<app-card>
  <h1>Attachments</h1>

  <div class="attachment-list">
    <div *ngIf="project">
      <app-attachment-card
        *ngFor="let attachment of project.attachments"
        [name]="attachment.name"
        [type]="getAttachmentType(attachment.type)"
        (click)="downloadAttachment(attachment)"
      >
      </app-attachment-card>
    </div>
  </div>
</app-card>

<app-card>
  <div class="header">
    <h1>Scope of Work</h1>
    <button mat-flat-button color="primary" (click)="showAddScopeForm()">
      Add Scope
    </button>
  </div>

  <div *ngIf="!scopes.length; else list" class="no-scope-message">
    You have not yet added scope of work.
  </div>

  <ng-template #list>
    <mat-accordion multi>
      <mat-expansion-panel
        class="mat-elevation-z0"
        *ngFor="let scope of getScopes()"
        expanded
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>folder</mat-icon>
            {{ scope.name | uppercase }}

            <span class="spacer"></span>
            <mat-icon (click)="deleteScope(scope)">delete_forever</mat-icon>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <table class="task-list">
          <tbody *ngFor="let task of getTasks(scope); let i = index">
            <tr>
              <td width="300px">
                {{ task.name }}
              </td>
              <td align="right" width="100px">{{ task.qty }}</td>
              <td align="right" width="100px">{{ task.unit }}</td>
              <td align="right">
                <mat-icon (click)="showAddMaterialsForm(task)">add</mat-icon>
                <mat-icon (click)="editTask(task)">edit</mat-icon>
                <mat-icon (click)="deleteTask(task)">delete_forever</mat-icon>
              </td>
            </tr>
            <tr>
              <td width="100%" colspan="4" class="material-list-container">
                <table class="material-list">
                  <tr class="header">
                    <td width="300px">Materials</td>
                    <td width="100px">Quantity</td>
                    <td width="100px">Unit</td>
                  </tr>
                  <tr *ngFor="let material of task.materials">
                    <td width="300px">
                      {{ material.name }}
                    </td>
                    <td align="right" width="100px">
                      {{ material.qty }}
                    </td>
                    <td align="right" width="100px">{{ material.unit }}</td>
                    <td align="right"></td>
                  </tr>
                </table>
              </td>
            </tr>
          </tbody>
        </table>

        <button
          mat-button
          color="primary"
          (click)="showAddScopeWorkForm(scope)"
        >
          Add new task
        </button>
      </mat-expansion-panel>
    </mat-accordion>
  </ng-template>
</app-card>

<app-action-panel>
  <button mat-raised-button (click)="exit()" [disabled]="saving">
    Save and Exit
  </button>
  <button mat-raised-button (click)="update()" [disabled]="saving">Save</button>
  <button
    mat-raised-button
    color="primary"
    [disabled]="saving"
    (click)="complete()"
  >
    Mark as Complete
  </button>
</app-action-panel>
